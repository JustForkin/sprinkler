{"version":3,"file":"bundle.js","sources":["node_modules/browserify/node_modules/browser-pack/_prelude.js","src/sprinkler.js","src/loadimages.js","src/particle.js","src/stat.js"],"names":["loadImages","require","Particle","stat","randomIn","randomPick","samplePoisson","extendValid","source","dest","k","hasOwnProperty","makeCanvasAutoFullwindow","canvas","resizeCanvas","width","window","innerWidth","height","innerHeight","addEventListener","Sprinkler","loads","particles","running","past","ctx","getContext","createParticle","options","w","h","image","selectImages","zMax","Math","max","zMin","rMin","rMax","aMin","aMax","dxMin","dxMax","dyMin","dyMax","dzMin","dzMax","drMin","drMax","daMin","daMax","ddxMin","ddxMax","ddyMin","ddyMax","ddzMin","ddzMax","ddrMin","ddrMax","ddaMin","ddaMax","createParticles","dt","i","particlesInSecond","imagesInSecond","particlesInDt","numOfNewParticles","push","tickModel","l","load","startOptions","bufferParticles","visible","pw","ph","maxRadius","length","tick","z","y","tickView","imgW","imgH","clearRect","globalAlpha","a","translate","x","rotate","r","drawImage","img","floor","setTransform","startAnimationLoop","loopFn","present","Date","now","requestAnimationFrame","startAnimation","this","imagePaths","callback","err","imageElements","loadId","random","toString","start","defaultOptions","Object","prototype","call","type","PI","stopAfter","Infinity","onStop","startId","exports","create","extension","version","module","imgSrcs","then","imgs","numberOfImages","onload","onloadsCalled","thereWasError","thereWasSuccess","isFinalImage","onerror","errMsg","Image","src","dx","dy","dz","dr","da","ddx","ddy","ddz","ddr","dda","min","d","array","continuousIndex","discreteIndex","rate","L","p","u","exp"],"mappings":"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","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","\n// ****************\n// Helper functions\n// ****************\n\nvar loadImages = require('./loadimages');\nvar Particle = require('./particle').Particle;\n\nvar stat = require('./stat');\nvar randomIn = stat.randomIn;\nvar randomPick = stat.randomPick;\nvar samplePoisson = stat.samplePoisson;\n\nvar extendValid = function (source, dest) {\n  // Purpose: fill valid options to default options object.\n  // Valid option in a source exist in dest and is same type.\n  // Return\n  //   nothing, modifies dest in place.\n  var k;\n  for (k in source) {\n    if (source.hasOwnProperty(k)) {\n      if (dest.hasOwnProperty(k)) {\n        if (typeof source[k] === typeof dest[k]) {\n          dest[k] = source[k];\n        }\n      }\n    }\n  }\n};\n\nvar makeCanvasAutoFullwindow = function (canvas) {\n  // Canvas is resized when window size changes, e.g.\n  // when a mobile device is tilted.\n  //\n  // Parameter\n  //   canvas\n  //     HTML Canvas element\n  //\n  var resizeCanvas = function () {\n    canvas.width = window.innerWidth;\n    canvas.height = window.innerHeight;\n  };\n  // resize the canvas to fill browser window dynamically\n  window.addEventListener('resize', resizeCanvas, false);\n  // Initially resized to fullscreen.\n  resizeCanvas();\n};\n\n\n\n// **********\n// Exceptions\n// **********\n//...\n\n\n\n// ***********\n// Constructor\n// ***********\n\nvar Sprinkler = function (canvas) {\n\n  // All the loaded images are stored here\n  var sourceImages = [];\n\n  // Each load has a separate id and a set of starts.\n  // New load is created on load call. New start for a load is\n  // created on start call.\n  var loads = {};\n\n  // Images are modeled as particles and stored here\n  var particles = [];\n\n  // To pause animation loop\n  var running = false;\n\n  // number, unix timestamp milliseconds of most recent frame.\n  var past = null;\n\n  // Everything is drawn on canvas.\n  var ctx = canvas.getContext('2d');\n\n  // Make canvas resize automatically to full window area\n  makeCanvasAutoFullwindow(canvas);\n\n  // We use this to add particles in to the model.\n  var createParticle = function (options) {\n    // Turn images to particles\n    var p, w, h, image;\n    w = canvas.width;\n    h = canvas.height;\n\n    image = randomPick(options.selectImages);\n\n    return new Particle(\n      randomIn(0, w), // x, randomize start point\n      -options.zMax * Math.max(image.width, image.height) / 2, // y, maxRadius above canvas top\n      randomIn(options.zMin, options.zMax), // z, scale\n      randomIn(options.rMin, options.rMax), // rotation\n      randomIn(options.aMin, options.aMax), // a, alpha, opacity\n      randomIn(options.dxMin, options.dxMax), // dx, horizontal movement\n      randomIn(options.dyMin, options.dyMax), // dy, falling speed\n      randomIn(options.dzMin, options.dzMax), // dz\n      randomIn(options.drMin, options.drMax), // dr, rotation speed, rads/sec\n      randomIn(options.daMin, options.daMax), // da\n      randomIn(options.ddxMin, options.ddxMax), // ddx\n      randomIn(options.ddyMin, options.ddyMax), // ddy\n      randomIn(options.ddzMin, options.ddzMax), // ddz\n      randomIn(options.ddrMin, options.ddrMax), // ddr\n      randomIn(options.ddaMin, options.ddaMax), // dda\n      image,\n      image.width, image.height\n    );\n  };\n\n  var createParticles = function (options, dt) {\n    var i;\n    var particlesInSecond = options.imagesInSecond;\n    var particlesInDt = dt * particlesInSecond;\n    var numOfNewParticles = samplePoisson(particlesInDt);\n    for (i = 0; i < numOfNewParticles; i += 1) {\n      particles.push(createParticle(options));\n    }\n  };\n\n  // Model is simulated forward every frame\n  var tickModel = function (dt) {\n    // Parameter\n    //   dt\n    //     simulation time, seconds\n    var i, k, l, load, startOptions, h,\n        bufferParticles, visible, pw, ph, maxRadius;\n\n    // To avoid huge wave of particles, they are created only\n    // if dt is close to given framerate.\n    if (dt < 0.5) {\n      // Simulate each particle\n      for (i = 0; i < particles.length; i += 1) {\n        particles[i].tick(dt);\n      }\n\n      // Create particles. Each start call has its own configuration.\n      for (k in loads) {\n        if (loads.hasOwnProperty(k)) {\n          load = loads[k];\n          for (l in load) {\n            if (load.hasOwnProperty(l)) {\n              startOptions = load[l];\n              createParticles(startOptions, dt);\n            }\n          }\n        }\n      }\n    }\n\n    // Clean up.\n    // Remove particles that are out of screen\n    // by replacing particles array.\n    h = canvas.height;\n    bufferParticles = [];\n    for (i = 0; i < particles.length; i += 1) {\n      pw = particles[i].w;\n      ph = particles[i].h;\n      maxRadius = particles[i].z * Math.max(pw, ph) / 2;\n      visible = (particles[i].y < h + maxRadius);\n      if (visible) {\n        bufferParticles.push(particles[i]);\n      }\n    }\n    particles = bufferParticles;\n  };\n\n  // View is rendered each frame\n  var tickView = function () {\n    // Draw; View current model\n    var i, imgW, imgH;\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n    for (i = 0; i < particles.length; i += 1) {\n      ctx.globalAlpha = particles[i].a;\n      imgW = particles[i].z * particles[i].w;\n      imgH = particles[i].z * particles[i].h;\n      ctx.translate(particles[i].x, particles[i].y);\n      ctx.rotate(particles[i].r);\n      ctx.drawImage(\n        particles[i].img,\n        -Math.floor(imgW / 2), // gravity to image center\n        -Math.floor(imgH / 2),\n        imgW, imgH\n      );\n      ctx.setTransform(1, 0, 0, 1, 0, 0); // resetTransform\n      ctx.globalAlpha = 1; // reset alpha\n    }\n  };\n\n  var startAnimationLoop = function loopFn() {\n    var present, dt;\n\n    // Time difference from previous frame in milliseconds\n    present = Date.now();\n    dt = (past === null) ? 0 : present - past;\n    past = present;\n\n    // Update Model\n    tickModel(dt / 1000); // secs\n\n    // Draw; View current model\n    tickView();\n\n    // Recursion\n    // Allow only one viewLoop recursion at a time.\n    if (running) {\n      window.requestAnimationFrame(loopFn);\n    }\n  };\n\n  var startAnimation = function () {\n    if (!running) {\n      running = true;\n      startAnimationLoop();\n    }\n  };\n\n  var stopAnimation = function () {\n    running = false;\n  };\n\n  this.load = function (imagePaths, callback) {\n    // Parameter\n    //   imagePaths\n    //     array\n    //   callback\n    //     function (err, start)\n    //\n    // Throw\n    //   'InvalidOptionsError'\n    loadImages(imagePaths, function then(err, imageElements) {\n      if (err) { callback(err, null); return; }\n\n      // loads is browsed through when creating particles.\n      var loadId = Math.random().toString();\n      loads[loadId] = {};\n\n      var start = function start(options) {\n        // Parameter\n        //   options\n        //     Do not modify this object as start might be called\n        //     with it multiple times.\n        var i, defaultOptions;\n\n        // Default parameter\n        if (typeof options === 'undefined') {\n          options = {};\n        }\n\n        // Invalid parameter\n        if (Object.prototype.toString.call(options) !== '[object Object]') {\n          throw 'InvalidOptionsError';\n        }\n\n        // Various start options\n        defaultOptions = {\n          type: 'default',\n          selectImages: imageElements,\n          zMin: 0.38, zMax: 1,\n          rMin: 0, rMax: 2 * Math.PI,\n          aMin: 1, aMax: 1,\n          dxMin: -1, dxMax: 1,\n          dyMin: 100, dyMax: 100,\n          dzMin: 0, dzMax: 0,\n          drMin: -1, drMax: 1,\n          daMin: 0, daMax: 0,\n          ddxMin: 0, ddxMax: 0,\n          ddyMin: 0, ddyMax: 0,\n          ddzMin: 0, ddzMax: 0,\n          ddrMin: 0, ddrMax: 0,\n          ddaMin: 0, ddaMax: 0,\n          imagesInSecond: 7,\n          stopAfter: Infinity,\n          onStop: function noop() {}\n        };\n\n        // Push all valid options to defaultOptions.\n        extendValid(options, defaultOptions);\n        // selectImages needs still to be defined.\n\n        // Map image indices to actual image objects.\n        if (options.hasOwnProperty('selectImages')) {\n          defaultOptions.selectImages = [];\n          for (i = 0; i < options.selectImages.length; i += 1) {\n            defaultOptions.selectImages[i] = imageElements[options.selectImages[i]];\n          }\n        }\n\n        options = defaultOptions;\n\n        var startId = Math.random().toString();\n        loads[loadId][startId] = options;\n\n        startAnimation();\n        return function stop() {\n          delete loads[loadId][startId];\n        };\n      };\n\n      callback(null, start);\n    });\n  };\n};\n\nexports.create = function (canvas, options) {\n  return new Sprinkler(canvas, options);\n};\n\n\n\n// *************\n// Extendability\n// *************\n// Usage\n//   var s = Sprinkler.create(...)\n//   Sprinkler.extension.myFunction = function (...) {...}\n//   s.myFunction()\nexports.extension = Sprinkler.prototype;\n\n\n\n// *******\n// Version\n// *******\nexports.version = '0.4.3';\n","module.exports = function loadImages(imgSrcs, then) {\n  // then(err, imgElements)\n  // Calls then after all the images were loaded.\n  var i, imgs, numberOfImages, onload, onloadsCalled,\n    thereWasError, thereWasSuccess;\n  numberOfImages = imgSrcs.length;\n  thereWasSuccess = false;\n  thereWasError = false;\n\n  imgs = [];\n\n  onloadsCalled = 0;\n  onload = function () {\n    // Note:\n    //   this = Image\n    if (!thereWasError) {\n      onloadsCalled += 1;\n      var isFinalImage = (onloadsCalled === numberOfImages);\n      if (isFinalImage) {\n        thereWasSuccess = true;\n        then(null, imgs);\n      }\n    }\n  };\n\n  onerror = function (errMsg) {\n    // Note:\n    //   this = Image\n\n    // No errors after success.\n    if (!thereWasSuccess) {\n      thereWasError = true;\n      then(errMsg, null);\n    }\n\n    // Prevent firing the default event handler\n    // https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers.onerror#Parameters\n    return true;\n  };\n\n  for (i = 0; i < imgSrcs.length; i += 1) {\n    imgs.push(new Image());\n    imgs[i].onload = onload;\n    imgs[i].onerror = onerror;\n    imgs[i].src = imgSrcs[i];\n  }\n};\n","\nvar Particle = function ( x, y, z, r, a,\n                          dx, dy, dz, dr, da,\n                          ddx, ddy, ddz, ddr, dda,\n                          img, w, h) {\n  this.x = x;\n  this.y = y;\n  this.z = z; // scale\n  this.r = r;\n  this.a = a; // opacity\n  this.dx = dx;\n  this.dy = dy;\n  this.dz = dz;\n  this.dr = dr;\n  this.da = da;\n  this.ddx = ddx;\n  this.ddy = ddy;\n  this.ddz = ddz;\n  this.ddr = ddr;\n  this.dda = dda;\n\n  this.img = img; // source image // read-only\n  this.w = w; // source image width // read-only\n  this.h = h; // source image height // read-only\n};\n\nParticle.prototype.tick = function (dt) {\n  // Parameter\n  //   dt\n  //     seconds\n  this.x += this.dx * dt;\n  this.y += this.dy * dt;\n  this.z += this.dz * dt;\n  this.r += this.dr * dt;\n  this.a = Math.min(1, Math.max(0, this.a + this.da * dt));\n  this.dx += this.ddx * dt;\n  this.dy += this.ddy * dt;\n  this.dz += this.ddz * dt;\n  this.dr += this.ddr * dt;\n  this.da += this.dda * dt;\n};\n\nexports.Particle = Particle;\n","exports.randomIn = function (min, max) {\n  // Continuous uniform distribution.\n  // Return x: min <= x < max\n  var d = max - min;\n  return min + d * Math.random();\n};\n\nexports.randomPick = function (array) {\n  // Return one randomly picked element.\n  // Discrete uniform distribution.\n  var min = 0;\n  var max = array.length;\n  var continuousIndex = exports.randomIn(min, max);\n  var discreteIndex = Math.floor(continuousIndex);\n  var i = discreteIndex;\n  return array[i];\n};\n\nexports.samplePoisson = function (rate) {\n  // Purpose: number of images to drop in each interval.\n  // Take a sample from poisson distribution.\n  // https://en.wikipedia.org/wiki/Poisson_distribution#Generating_Poisson-distributed_random_variables\n  var L, k, p, u;\n  L = Math.exp(-rate);\n  k = 0;\n  p = 1;\n  do {\n    k += 1;\n    u = Math.random();\n    p *= u;\n  } while (p > L);\n  return k - 1;\n};\n"]}